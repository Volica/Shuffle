# ✅ 四人平均 25% 的任务分配（按 Shuffle 类型分工）

> **每个人独立负责一个 Shuffle 机制的研究、实验、文档撰写。**
> Hash / Sort 是题目要求的两种，Bypass Merge / File Consolidation 作为拓展内容。

---

# 👤 **成员 A – 基于 Hash Shuffle（25%）**

### **主要任务**

1. 研究 Hash-Based Shuffle 的执行流程
2. 整理其优缺点
3. 分析适用场景（小规模数据、简单 Shuffle、无排序需求）
4. 编写实验代码（设置 `spark.shuffle.manager=hash`）
5. 在不同数据规模下进行实验
6. 记录指标并制作结果表格（Shuffle文件数量、内存使用、执行时间）
7. 撰写 README 对应章节（原理 + 实验步骤 + 结果分析）

### **实验截图要求**

* Spark job 成功截图
* Shuffle Read/Write 指标截图
* Hash Shuffle 产生大量小文件现象（如果有）

---

# 👤 **成员 B – 基于 Sort Shuffle（25%）**

### **主要任务**

1. 研究 Sort-Based Shuffle 的执行流程（排序 → 合并 → Spill）
2. 整理其优势（文件数量少、更稳定）与不足（排序开销）
3. 说明其为何是 Spark 默认 Shuffle
4. 编写实验代码（默认即可）
5. 在相同数据规模下做对比实验
6. 记录指标：

   * 文件数量
   * 排序时间
   * Spill 次数
7. 撰写 README“Sort Shuffle”分析章节

### **实验截图要求**

* Spark UI 的 Shuffle Spill 图
* Reduce 拉取文件数量对比

---

# 👤 **成员 C – Bypass Merge Shuffle（拓展一，25%）**

### **主要任务**

1. 研究 Bypass Merge 的触发条件（reduce 分区数量 < threshold）
2. 绘制流程图（直接写临时文件 → 最终一次 merge）
3. 编写实验代码：

   * 调整 reduce 分区数 = 10（触发 Bypass）
   * 修改 `spark.shuffle.sort.bypassMergeThreshold`
4. 对比性能
5. 分析优势：无排序开销
6. 撰写拓展部分报告

### **实验截图要求**

* Shuffle Bypass merge 触发的运行日志
* Shuffle Spill 文件结构的截图（少排序文件）

---

# 👤 **成员 D – Shuffle File Consolidation（拓展二，25%）**

### **主要任务**

1. 研究 File Consolidation 的作用（减少小文件）
2. 开关配置：
   `spark.shuffle.consolidateFiles=true`
3. 实验对比：

   * consolidateFiles = false
   * consolidateFiles = true
4. 记录 reduce 拉取文件数量
5. 分析适用场景（大规模 map 任务、小文件过多场景）
6. 撰写拓展章节

### **实验截图要求**

* Spark UI显示 Shuffle 文件数量明显减少
* 对比 consolidate 开/关下的目录结构截图

---

# 🎯 额外协作任务（不计入个人 25%，公共完成）

## 📌 **PPT（4人合作完成）**

### PPT 结构建议：

1. 项目背景
2. 四种 Shuffle 流程说明（四人负责自己的那一页）
3. 统一的对比图（执行时间、Shuffle 文件数量）
4. 结论 & 推荐使用场景

---

## 🎤 **最终汇报（2 人负责）**

### 报告人 1

* 背景、Hash Shuffle、Sort Shuffle、整体实验方法

### 报告人 2

* Bypass Merge、File Consolidation、实验对比、结论

---

# ✨ 最终成果结构（符合作业模板）

```
.
├── code/
│   ├── hash_shuffle_test.py
│   ├── sort_shuffle_test.py
│   ├── bypass_shuffle_test.py
│   └── consolidate_shuffle_test.py
└── README.md
```

README 分章节：

* 研究目的
* 研究内容（含拓展）
* 实验环境
* 实验负载
* 实验步骤（四人分别写）
* 实验结果与分析（表格 + 图）
* 结论
* 分工（即上述四人 25% 内容）
